#type:     node
#context:  sop
#internal: labs::ml_cv_keypoint_metadata::1.0
#icon:     /labs_icons/sidefxlabs_default.svg
#since:    20.5

= Labs ML CV Keypoint Metadata =

"""Prepares the keypoint metadata."""


This node takes in a set of points and prepares the keypoint metadata to be exported to the [COCO JSON|https://cocodataset.org/#home] file by the [Labs ML CV ROP Annotation Output SOP|Node:sop/labs--ml_cv_rop_annotation_output-1.0].

NOTE:
    Each input point must have a unique string attribute `kp_name`. (The prefix `kp` stands for keypoint.)

:box:
    #display: raised yellow

    The original ML Computer Vision tools were developed by the Synthetic Data team at Endava PLC.


@parameters

    == Render ==

    Camera LOP Path:
        #id: loppath
        The path to the LOP node from which the camera primitive is sourced.
        
    Camera Primitive:
        #id: primpath
        The USD primitive path that points to the camera, used for obtaining screen space coordinates of the keypoints.
        
    Camera Resolution:
        #id: camres
        The camera resolution. Defaults to @res, a PDG attribute created by the [Labs ML CV ROP Synthetic Data TOP|Node:top/labs--ml_cv_rop_synthetic_data-1.0].

    Compute Ground Truth:
        #id: compgt
        Enables the calculation of ground truth for keypoint
        positions (both screen-space and global). This is useful when separating this node's functions and computing ground truth further downstream.
        
    Include Keypoint 3D Metadata:
        #id: kp3d
        Adds keypoint 3D Metadata to the COCO JSON file exported by the [Labs ML CV ROP Annotation Output SOP|Node:sop/labs--ml_cv_rop_annotation_output-1.0].
        
    == Skeleton Metadata ==

    Include Skeleton Connectivity:
        #id: hasSkel
        Enables the creation of the skeleton connectivity map. This connectivity is used to optionally
        generate a skeleton from keypoints and is useful for visualizing results within the ML training pipeline.
        
    Visualize Connectivity:
        #id: visskel
        Enables the creation of edges between skeleton points that will be
        connected in the Ground Truth, allowing preview of this
        connectivity in the Houdini viewport.

    Skeleton Connections:
        #id: skelconnections
        The list of ordered pair point connections separated by commas, for example: `[0,1],[1,2]`.

    Add Connections:
        #id: skelfrominput
        Creates the connections multiparm from the Skeleton Connections parameter and input points.

    Connections:
        #id: skeletons
        The number of skeleton connections.


    === Skeletons ===

    Connection:
        #id: connection#
        The ordered pair for defining the skeleton connection.
        
    Skeleton Weight:
        #id: skel_weight#
        The importance of the skeleton link between keypoints.
        
    Skeleton Color:
        #id: skel_color#
        The color of the skeleton connection. (This is not visualized in the Houdini viewport).
        
    == Keypoint Metadata ==

    Assign Keypoint Metadata:
        #id: assignkp
        Enables the creation of keypoint metadata by this node.

    Assign Point Colors:
        #id: viscolor
        Enables the assignment of colors to the keypoints.
        
    Add Input Keys:
        #id: metadatafrominput
        Generates the Keypoints multiparm based on the input points.
        
    Keypoints:
        #id: keypoints
        The number of keypoints.
        
    === Keypoints ===

    Keypoint ID:
        #id: kpid#
        The index of the keypoint. This number cannot be 0. The ID value defaults to the point number plus 1.
        
    Keypoint Name:
        #id: kpname#
        The name of the keypoint, initially set by the attribute `kp_name`.
        
    Keypoint Sigma:
        #id: kpsigma#
        The weight used in the Object Keypoint Similarity (OKS)
        calculation during evaluation, adjusted to indicate the expected precision of the model.
        
    Keypoint Color:
        #id: kpcolor#
        The color of the Keypoint for ML visualization
        
    Keypoint Type:
        #id: kptype#
        Defines the type of the keypoint, used for grouping multiple keypoints. For example, all keypoints of a left hand would have the type `'hand'`.
        
    Swapable:
        #id: kpswap#
        Specifies the mirror point for each keypoint, if one exists (e.g., `'elbow_left'`, `'elbow_right'`). This is useful for data augmentation when flipping the image horizontally.


@examples

    TIP:
        When viewing in Houdini's Help Browser, please copy the example file's URL to a regular browser to proceed with the download.

    - [Example File|https://github.com/sideeffects/SideFXLabsExamples/blob/main/examples/ml_computer_vision/ml_computer_vision.1.0.zip]


@related

    - [Node:sop/labs--ml_cv_rop_annotation_output-1.0]
    - [Node:top/labs--ml_cv_rop_synthetic_data-1.0]